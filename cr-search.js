!function(e){e.fn.crSearch=function(t){let n=e.extend({},{minCharsToShowMenu:3,object:[],maxResults:5,placeholderText:"Введите запрос",noResultsText:"Нет результатов",showImage:!0,useNaturalLanguage:!1,onSelect:null,onInput:null},t);return this.each(function(){let t=e(this),i=e('<div class="suggestions-container"></div>'),s=e('<i class="clear-icon fas fa-times"></i>');t.attr("placeholder",n.placeholderText),t.after(s),s.on("click",function(){t.val("").focus(),i.empty().hide(),s.hide()}),t.on("input",function(){let l=t.val().trim();if(s.toggle(l.length>0),l.length>=n.minCharsToShowMenu){var a,o,c;let u=n.useNaturalLanguage?function e(t,n,i){let s=new Fuse(n,{keys:["text"]}),l=s.search(t);return l.map(e=>e.item).slice(0,i)}(l,n.object,n.maxResults):(a=l,o=n.object,c=n.maxResults,o.filter(function(e){return e.text.toLowerCase().includes(a.toLowerCase())}).slice(0,c));if(i.empty(),u.length>0)e.each(u,function(s,l){if(s>=n.maxResults)return!1;let a=e('<div class="suggestion"></div>');if(n.showImage&&l.imageUrl){let o=e('<img data-lazy-image_resize="true" data-lazy-image_detect="css-width">');o.attr("src",l.imageUrl),a.append(o)}let c=e('<div class="suggestion-text">'+l.text+"</div>");a.append(c),a.on("click",function(){t.val(l.text),i.empty().hide(),"function"==typeof n.onSelect&&n.onSelect(l)}),i.append(a)}),i.insertAfter(t).show();else{let r=e('<div class="no-results">'+n.noResultsText+"</div>");i.append(r),i.insertAfter(t).show()}}"function"==typeof n.onInput&&n.onInput(l)}),t.on("keyup",function(e){let n=t.val().trim();0===n.length&&8===e.keyCode&&(i.empty().hide(),s.hide())}),e(document).on("click",function(n){e(n.target).closest(".suggestions-container").length||e(n.target).is(t)||(i.empty().hide(),s.hide())})})}}(jQuery);
