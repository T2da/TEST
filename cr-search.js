(function(n){n.fn.crSearch=function(t){const i=n.extend({minCharsToShowMenu:3,object:[],maxResults:5,placeholderText:"Введите запрос",noResultsText:"Нет результатов",showImage:!0,useNaturalLanguage:!1},t);return this.each(function(){function f(n,t,i){const r=new Fuse(t,{keys:["text"]}),u=r.search(n),f=u.slice(0,i);return f.map(n=>n.item)}function e(n,t){return t.filter(function(t){return t.text.toLowerCase().includes(n.toLowerCase())})}const t=n(this),r=n('<div class="suggestions-container"><\/div>');t.attr("placeholder",i.placeholderText);const u=n('<i class="clear-icon fas fa-times"><\/i>');t.after(u);u.on("click",function(){t.val("").focus();r.empty().hide();u.hide()});t.on("input",function(){const o=n(this).val().trim();if(r.empty().hide(),u.toggle(o.length>0),o.length>=i.minCharsToShowMenu){let u;if(u=i.useNaturalLanguage?f(o,i.object,i.maxResults):e(o,i.object,i.maxResults),u.length>0)n.each(u,function(u,f){const e=n('<div class="suggestion"><\/div>');if(i.showImage){const t=n('<img class="suggestion-image" src="'+f.imageUrl+'">');e.append(t)}const o=n('<div class="suggestion-text">'+f.text+"<\/div>");e.append(o);e.on("click",function(){t.val(f.text);r.empty().hide()});r.append(e)}),r.insertAfter(t).show();else{const u=n('<div class="no-results">'+i.noResultsText+"<\/div>");r.append(u);r.insertAfter(t).show()}}});t.on("keyup",function(t){const i=n(this).val().trim();i.length===0&&t.keyCode===8&&(r.empty().hide(),u.hide())});n(document).on("click",function(i){n(i.target).closest(".suggestions-container").length||n(i.target).is(t)||(r.empty().hide(),u.hide())})})}})(jQuery);$(document).ready(function(){for(var r,u=data.columns.map(n=>n.name),t=data.rows.map(n=>Object.values(n)),i=[],n=0;n<t.length;n++)i.push(t[n]);r=i.map(function(n){return{text:n[0],imageUrl:n[1]}});$(el).closest(".cr-form").css("z-index",799);$(el).find("input").searchWithSuggestions({object:r,minCharsToShowMenu:1,maxResults:5,placeholderText:"Введите запрос",noResultsText:"Нет результатов",showImage:!0,useNaturalLanguage:!0})});
